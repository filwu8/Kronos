# 置信度评估与提升指南

## 1. 置信度如何评估

- 指标：预测不确定性区间相对收盘价的平均宽度
  - 对每个预测日：band_width_pct = (close_upper - close_lower) / close
  - 对整段预测：avg_band_pct = mean(band_width_pct) × 100%
- 标签映射（默认阈值，可调）：
  - avg_band_pct < 4% → 高
  - 4% ≤ avg_band_pct < 8% → 中
  - avg_band_pct ≥ 8% → 低
- 异常处理：如区间或收盘为缺失/无效，回退为“中”

## 2. 如何提升置信度

- 增大采样次数 sample_count（如 3–5，显卡允许可到 5–10），多路径均值更稳
- 降低采样温度 Temperature（如 0.6–0.9），减少随机性
- 适度降低 top_p（如 0.8–0.9），抑制尾部采样
- 缩短预测天数 pred_len（如 5–10 天），时程越短不确定性越低
- 适度增大历史窗口 lookback（如 400–1500），让模型拥有更充分的上下文（注意性能平衡）
- 高性能模式（RTX 5090）有助于提高 sample_count 与 lookback，使结果更稳

## 3. 前端如何自定义参数

- 侧边栏 → 预测天数（pred_len）：滑块设置
- 侧边栏 → 🔧 高级参数：
  - 关闭“使用推荐参数”后可自定义历史窗口长度（lookback）、采样次数（sample_count）
  - 采样温度（T）与核采样（top_p）为独立滑块
- 页面内提示：已加入中文提示说明如何自定义与如何提升置信度

## 4. 与价格约束的关系

- 价格约束（涨跌幅限制+量化到分+自然内边距）只在原始预测越界时生效
- 约束不会直接改变置信度，但若原始预测越界频繁，可能意味着模型分歧较大，avg_band_pct 隐含会偏高 → 置信度偏低

## 5. 建议的下一步

- 如需微调阈值（例如 3%/6%/9%），或把 avg_band_pct 数值一并显示在“预测摘要”，请告知
- 若要把“置信度(高/中/低)”作为筛选条件用于批量选股，我可以在表格/导出结果中附加该标签与原始数值供排序

